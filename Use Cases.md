# Use Case

## Use Cases to support

### UC 1: [Device Registration with existing certificate](#register-devices-with-pki-certificates)
    Description: This UC is already existing but we need to find a way to connect devices with PKI certificates
### UC 2: [Basic authentification replaced by certificates](#replace-basic-authentication)
    Description: This UC replaces the existing registered way of devices to connect devices. Possible way to move a device to a different tenant.
### UC 3: [Certificate create](#New-Certificates)
    Description: This UC is to manually and possibly automatically create a certificate of a device
### UC 4: [Certificate Renewal](#Renewal-of-certificates)
    Description: This UC is to manually and possibly automatically renewal a certificate of a device
### UC 5: [Certificate Revokation](#revoke-of-certificate)
    Description: This UC is to manually and possibly automatically revokation of a certificate
### UC 6: [Certificate Status](#status-of-certificate)
    Description: This UC is to manually and possibly automatically get the actuall status of a device certificate
### UC 7: [Certificate Replacement](#replace-a-certificate)
    Description: This UC is to manually and possibly automatically replace an existing certificate on a device. No matter whcih status a device certificate has.
### UC 8: [Certificate Reinstate](#reinstate-a-certificate)
    Description: The UC is to manually and possibly automatical reinstate a revoked certificate.
### UC 9: [Certificate Deletion](#delete-a-certificate)
    Description: This UC is to manually and possibly automatically delete a device certificate.
### UC 10: [Certificate Distribution via Gateway](#distribute-a-certificate-via-gateway)
    Description: This UC is manually and possibly automatically allow a device acting as device gateway to distribute certificates to device childs

### Register devices with pki-certificates
    1. A C8y user should be used to upload a PKI-generated certificate to the tenant which initiates the upload.

Assumptions: 
    1. The device already has a private certificate
    2. The user has the public certificate

### Replace basic authentication
    1. A C8y user should be used to replace a registered device which uses basic authentication (username and password) with device certificate generated by the PKI-Provider
    
Assumptions: 
    1. The device Agent can deal with device certificates
    2. The device Agent can request with the certificate a JWT Token with MQTT to the Token for HTTP [https://cumulocity.com/guides/device-sdk/mqtt/#jwt-token-retrieval](https://cumulocity.com/guides/device-sdk/mqtt/#jwt-token-retrieval) 

### New Certificates 
    1. issued from a non embedded device (single)
    2. issued from a cumulocity sub-tenant (single and bulk) with the c8y-UI
    3. issued from a cumulocity advanced tenant (single and bulk)) with the c8y-UI
    4. issued from a cumulocity master tenant (single and bulk)) with the c8y-UI
    5. issued from an embedded device (not possible) (single and bulk)
        1. only possible if a new firmware with the certificate is installed in conjunction with the c8y-UI
    6. issued from a containerized environments (single)
        1. Needs to be clarified where the certificate is stored. Inside or outside the container

### Renewal of certificate
    1. when (at which time) can a renewal process be initiated?
    2. A C8y user should be used to renewal a certificate from Sub Tenant (User restrictions needed, maybe approval process as well)
    3. A C8y user should be used to renewal a certificate from Advanced Tenant
    4. A C8y user should be used to renewal a certificate from Management Tenant
    5. Should a certificate be renewaled from a device?
    6. Should a certificate be renewaled from PKI-Provider?

### Revoke of certificate
    1. A C8y user should be used to revoke a certificate from Sub Tenant
    2. A C8y user should be used to revoke a certificate from Advanced Tenant
    3. A C8y user should be used to revoke a certificate from Management Tenant
    4. Should a certificate be revoked from a device?
    5. Should a certificate be revoked from PKI-Provider?
    6. Revoke a device certificate after a particuler time

### Status of certificate
    1. A C8y user should be used to check the status of a certificate from Sub Tenant
    2. A C8y user should be used to check the status of a certificate from Advanced Tenant
    3. A C8y user should be used to check the status of a certificate from Management Tenant 
    4. Should we check the status of a certificate from a device?

### Replace a certificate
    1. A C8y user should be used to replace a certificate from Sub Tenant
    2. A C8y user should be used to replace a certificate from Advanced Tenant
    3. A C8y user should be used to replace a certificate from Management Tenant 
    4. Should a certificate be replaced from a device?
    5. Should a certificate be replaced from PKI-Provider?
    6. Replace a certificate after a particuler time

### Reinstate a certificate
    1. A C8y user should be used to reinstate a certificate from Sub Tenant
    2. A C8y user should be used to reinstate a certificate from Advanced Tenant
    3. A C8y user should be used to reinstate a certificate from Management Tenant 
    4. Should a certificate be reinstate from a device?
    5. Should a certificate be reinstate from PKI-Provider?
    6. Reinstate a certificate after a particuler time

### Delete a certificate
    1. A C8y user should be used to delete a certificate from Sub Tenant
    2. A C8y user should be used to delete a certificate from Advanced Tenant
    3. A C8y user should be used to delete a certificate from Management Tenant 
    4. Should a certificate be delete from a device?
    5. Should a certificate be delete from PKI-Provider?
    6. Delete a certificate after a particuler time

### Distribute a certificate via gateway
    1. A C8y user should be used to distribute a certificate from Sub Tenant
    2. A C8y user should be used to distribute a certificate from Advanced Tenant
    3. A C8y user should be used to distribute a certificate from Management Tenant 
    4. Should a certificate be distributed from a device?
    5. Should a certificate be distributed from PKI-Provider?



## Hardware Vendor considerations

### Responsibilities of Hardware Vendors
    1. Store the certificate in a secure manner to not be compromised by unauthorized people for
        embedded devices (OS is not accessible as user)
            e.g. io-key
        non embedded devices (OS is accessible as user)
            e.g. thin edge, thick edge, iphone, android
        Containerized environments, where the user is only able to upload a docker container 
            (gateway from some manufaturer.. e.g. Customer fronius)
    2. change the device agent to support the certificate operations for the defined Use Cases
### Vendor Questions
    1. Where to store the certificate on the device
        1. on non embedded devices
        2. on embedded devices
        3. on containerized environments
    2. How to store the certificates in a secure manner 
        1. on non embedded devices
        2. on embedded devices
        3. on containerized enironments

    
## Open  Questions
 3. where is the Protocol Gateway for EST running?
    5. It seams a TOMCAT is involved in the Architecture. 
        1. Who is responsible maintaining the TOMCAT?
        2. Do our customers have to configure a TOMCAT?
        3. e.g. https://doc.nexusgroup.com/display/PUB/EST+URI+configuration
    6. Do you have an overview list which use cases PKI-Provider supports?
    7. Do you have an view how often Reinstate is used? Do we need this?
    3. Which port is used for the status check of an device which possibly needs 2 be forwarded https://doc.nexusgroup.com/display/PUB/Default+ports+in+Certificate+Manager


# Archiv

#### Online Certificate Status Protocol (OCSP)
    1. The Online Certificate Status Protocol (OCSP) is an Internet protocol used for obtaining the revocation status of an certificate.
    2. OCSP  only provides information on the revocation status of certificates, but does not check the mathematical correctness of the signatures of the certificates, their validity period or any usage restrictions specified in the certificate. In addition, the client must first determine a certification chain.
    3. To get the certificate chain the client do not have enough ressource

#### Server-based Certificate Validation Protocol (SCVP) https://www.rfc-editor.org/info/rfc5055
    1. The Server-based Certificate Validation Protocol (SCVP) is an Internet protocol for determining the path between an X.509 digital certificate and a trusted root (Delegated Path Discovery) and the validation of that path (Delegated Path Validation) according to a particular validation policy. 
    2. It needs to be clarified if PKI-Provider supports this
        1. No it's not supported
    3. 
### Deletion of certificate
    1. Is the deletion of a certificate necessary?
        1. if the diskspace (RAM, SSD, HDD) of the device is not enough

### Source for new Certificates CA and RA
    1. CA is Online in the cloud
    2. CA is On-premise (optional)
        1. Only if the on-premise customer do not want to use online
    3. CA is Online on thick edge if necessary
    4. For thick edge which is offline certificates needs to be generated either on 1, 2 or 3

### Type of certificates
    1. Root certificate
        1. Certificate of the Authority
    2. Initialize device with factory certificate (needs to be the Management Tenant or the Advanced tenant)
        1. is used as fall back, if the device has to be moved from one cumulocity tenant to another
        2. this is step 1 within an enrollment process
    3. Initialize Integrator Certificate are needed to support for manufacturer–integrator–operator lifecycle
        1. is used as fall back, if the device has to be moved from one cumulocity tenant to another
        2. This would be step 1a within an enrollment process (optional)
    4. Device  Intermediate certificate
        1. This would be step 2 within an enrollment process (optional)
    5. Device Certificate
        1. This is the certificate of the device of the end customer 
### Enrollment over Secure Transport
    1. EST only works via HTTPS
        1. https://en.wikipedia.org/wiki/Enrollment_over_Secure_Transport
    2. EST over  COAP would be not priority one an even not necessary
    3. 

### Identity API
    1. Shall the microservice somehow be involved using the existing Identity API?


### Use Case based on  Device Certificates
    1. Device Onboarding
    2. Software Package based enrollment